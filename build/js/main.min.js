"use strict";function Dashboard(){this.globalState=!1,this.messages=["Create new card","Delete card","Changes saved","All fields are required","Fullscreen mode is active"],this.theme={basic:"#3798DC",dark:"#212121"},this.area={main:document.querySelector(".main-content"),container:document.querySelector(".content-area"),message:document.querySelector(".message"),creator:document.querySelector(".creator"),sidebarLeft:document.querySelector(".sidebar-left")},this.sidebar={title:document.querySelector(".input--title"),content:document.querySelector(".input--content"),author:document.querySelector(".input--author")},this.buttons={submit:document.querySelector(".btn-submit")},this["switch"]=document.querySelector(".input-switch"),this.toggle=document.querySelector(".switch-bar"),this.settings=document.querySelector(".settings")}function Task(e){Dashboard.call(this),this.id=nextID++,this.posX=0,this.posY=0,this.resizeX=0,this.resizeY=0,this.encodeData=JSON.parse(e),this.onDrag=this.draggable.bind(this),this.onResize=this.resize.bind(this),this.activeText=null,this.currentText=null,this.editArea=!1,this.activeArea=!0,this.escape=!1,this.saveStr=[],this.single={article:document.createElement("article"),header:document.createElement("header"),h:document.createElement("h2"),hText:document.createTextNode(""),paragraph:document.createElement("p"),paragraphText:document.createTextNode(""),author:document.createElement("p"),authorText:document.createTextNode(""),edit:document.createElement("span"),resize:document.createElement("div")},this.inputs={title:document.createElement("h2"),content:document.createElement("p"),author:document.createElement("p")},tasks.push(this),current.push(this.id),this.removeFields(),this.init()}var current=[],tasks=[],nextID=0;Dashboard.prototype.validate=function(){if(!this.globalState){var e={};for(var t in this.sidebar){if(!this.sidebar.hasOwnProperty(t)||!this.sidebar[t].value)return this.log("All fields are required"),!1;e[t]=this.sidebar[t].value}new Task(JSON.stringify(e))}},Dashboard.prototype.removeFields=function(){for(var e in this.sidebar)this.sidebar.hasOwnProperty(e)&&(this.sidebar[e].value="")},Dashboard.prototype.toggleTheme=function(e){this.globalState||(this["switch"].checked?this.area.main.style.backgroundColor=this.theme.dark:this.area.main.style.backgroundColor=this.theme.basic,this.toggleKeyCode=!1,e.keyCode&&(!this.toggleKeyCode&&this["switch"].checked?this.area.main.style.backgroundColor=this.theme.basic:this.area.main.style.backgroundColor=this.theme.dark,this["switch"].checked=!this["switch"].checked,this.toggleKeyCode=!this.toggleKeyCode))},Dashboard.prototype.toggleSidebar=function(e,t,i){this.globalState||(e.preventDefault(),120!==e.keyCode?(t.classList.toggle("sidebar-"+i+"-toggle"),t.classList.contains("sidebar-"+i+"-toggle")?t.classList.add("sidebar-"+i+"-toggle"):t.classList.remove("sidebar-"+i+"-toggle")):t.classList.toggle("sidebar-"+i+"-toggle"))},Dashboard.prototype.log=function(e){for(var t=0;t<this.messages.length;t++)this.messages.indexOf(e)===t&&(this.area.message.classList.add("animate-msg"),this.area.message.textContent=this.messages[t]);setTimeout(function(){this.area.message.classList.remove("animate-msg")}.bind(this),3e3)},Dashboard.prototype.toggleFullscreen=function(e){document.fullscreenElement&&document.mozFullScreenElement&&document.webkitFullscreenElement&&document.msFullscreenElement||(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},Dashboard.prototype.init=function(){var e=this;this.buttons.submit.addEventListener("click",function(t){t.preventDefault(),e.validate()}),this["switch"].addEventListener("click",this.toggleTheme.bind(this)),document.addEventListener("keydown",function(t){113===t.keyCode&&e.toggleFullscreen(document.querySelector("body")),115===t.keyCode&&e.toggleTheme(t),119===t.keyCode&&e.toggleSidebar(t,e.area.sidebarLeft,"left"),120===t.keyCode&&e.toggleSidebar(t,e.area.creator,"right")}),this.settings.addEventListener("click",function(t){e.toggleSidebar(t,e.area.sidebarLeft,"left")})},Task.prototype=Object.create(Dashboard.prototype),Task.prototype.constructor=Task,Task.prototype.create=function(){this.single.article.classList.add("task"),this.single.article.classList.add("task"+this.id),this.single.article.appendChild(this.single.edit),this.single.article.appendChild(this.single.header),this.single.article.appendChild(this.inputs.content),this.single.article.appendChild(this.inputs.author),this.single.article.appendChild(this.single.resize),this.single.header.appendChild(this.inputs.title),this.single.resize.classList.add("resize"),this.single.edit.classList.add("icon-edit"),this.single.header.classList.add("task-header"),this.inputs.title.classList.add("task-header__title"),this.inputs.content.classList.add("task__text"),this.inputs.author.classList.add("task__author"),this.inputs.title.appendChild(this.single.hText),this.inputs.title.appendChild(document.createElement("span")),this.inputs.content.appendChild(this.single.paragraphText),this.inputs.content.appendChild(document.createElement("span")),this.inputs.author.appendChild(this.single.authorText),this.inputs.author.appendChild(document.createElement("span")),this.single.hText.textContent=this.encodeData.title,this.single.paragraphText.textContent=this.encodeData.content,this.single.authorText.textContent=this.encodeData.author,this.area.container.appendChild(this.single.article),this.log("Create new card")},Task.prototype.pressedMouse=function(e){e.target!==this.single.edit&&(this.posX=e.clientX-this.single.article.offsetLeft,this.posY=e.clientY-this.single.article.offsetTop,this.edit(e),document.addEventListener("mousemove",this.onDrag)),e.target===this.single.resize&&(this.resizeX=e.clientX-this.single.article.clientWidth,this.resizeY=e.clientY-this.single.article.clientHeight,document.removeEventListener("mousemove",this.onDrag),document.addEventListener("mousemove",this.onResize)),e.target===this.single.edit&&(this.editArea=!this.editArea,this.edit(e),this.currentID(e))},Task.prototype.mouseUp=function(){document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("mousemove",this.onResize)},Task.prototype.draggable=function(e){var t=e.clientX-this.posX,i=e.clientY-this.posY,s=this.area.container.clientWidth-this.single.article.clientWidth,n=this.area.container.clientHeight-this.single.article.clientHeight;t>=s&&(t=s),i>=n&&(i=n),t<0&&(t=0),i<0&&(i=0),this.single.article.style.left=t+"px",this.single.article.style.top=i+"px"},Task.prototype.resize=function(e){var t=this.area.container.clientWidth-this.single.article.offsetLeft,i=this.area.container.clientHeight-this.single.article.offsetTop,s=e.clientX-this.resizeX,n=e.clientY-this.resizeY,a=150;s>=t&&(s=t),s<=a&&(s=a),n>=i&&(n=i),this.single.article.style.width=s+"px",this.single.article.style.minHeight=n+"px"},Task.prototype.edit=function(e){if(this.editArea){for(var t in this.inputs)this.inputs[t]===this.inputs.title&&this.activeArea&&(this.currentNode=this.inputs[t].childNodes,this.currentNode[1].classList.add("index")),27===e.keyCode?(this.inputs[t].childNodes[0].nodeValue=this.encodeData[t],this.currentNode[1].classList.remove("index"),this.editArea=!1,this.activeArea=!0):this.inputs[t]===e.target&&(this.currentNode[1].classList.remove("index"),this.currentNode=this.inputs[t].childNodes,this.currentNode[1].classList.add("index"),this.activeArea=!1);if(8===e.keyCode){var i=this.currentNode[0].textContent.slice(0,this.currentNode[0].textContent.length-1);this.currentNode[0].textContent=i}else if(13===e.keyCode){this.currentNode[1].classList.remove("index");for(var s in this.encodeData)this.encodeData[s]=this.inputs[s].textContent;this.log("Changes saved"),this.editArea=!1,this.activeArea=!0}else if(e.keyCode){var n=["Escape","CapsLock","Tab","ShiftLeft","ShiftRight","AltLeft","AltRight","ControlLeft","ControlRight","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];n.indexOf(e.code)===-1&&(this.currentNode[0].textContent+=e.key)}}else{if(!this.escape)for(var t in this.inputs)this.inputs[t].childNodes[0].nodeValue=this.encodeData[t];for(var t in this.inputs)this.inputs[t].childNodes[1].classList.remove("index");this.activeArea=!0}},Task.prototype.currentID=function(e){var t=this;current.forEach(function(i,s){if(e.target===t.single.edit){if(i===t.id)return!1;for(var n in tasks[s].inputs)tasks[s].inputs[n].childNodes[0].nodeValue=tasks[s].encodeData[n];tasks[s].editArea=!1,tasks[s].edit()}})},Task.prototype.init=function(){this.create(),this.single.article.addEventListener("mousedown",this.pressedMouse.bind(this)),document.addEventListener("mouseup",this.mouseUp.bind(this)),document.addEventListener("keydown",this.edit.bind(this))},window.addEventListener("load",function(){var e=new Dashboard;e.init()});